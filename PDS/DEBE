*          DATA SET CBT380     AT LEVEL 001 AS OF 06/14/79
         MACRO                                                          00001
&NAME    DEBCHK &CBAD,&TYPE=,&AM=,&MF=O                                 00002
.*                                                                      00003
.*                       *****************                              00004
.*                       *   VARIABLES   *                              00005
.*                       *  DECLARATION  *                              00006
.*                       *****************                              00007
.*                                                                      00008
         LCLB  &AM0,&AM1,&AM2,&AM3,&AM4,&AM5,&AM6,&AM7                  00009
         LCLB  &TYPEA,&TYPED,&TYPEV,&TYPEP,&ERR                         00010
         LCLC  &REG,&LABEL,&AMFC,&AMSC                                  00011
         LCLA  &A                                                       00012
.*                                                                      00013
.*                       **********                                     00014
.*                       * VERIFY *                                     00015
.*                       *  INPUT *                                     00016
.*                       **********                                     00017
.*                                                                      00018
         AIF   ('&MF' EQ 'O').DBCK020   BRANCH IF &MF OMITTED           00019
         AIF   ('&MF' EQ 'L').DBCK040   BRANCH IF &MF=L                 00020
         IHBERMAC 1001,MF,&MF                                           00021
&ERR     SETB  1                                                        00022
.*                                                                      00023
.*                       TEST &CBAD                                     00024
.*                                                                      00025
.DBCK020 AIF   (T'&CBAD NE 'O').DBCK040 BRANCH IF &CBAD SPECIFIED       00026
&ERR     SETB  1                        SET ERROR INDICATOR             00027
         IHBERMAC  2                                                    00028
.*                                                                      00029
.*                       ESTABLISH AND TEST &AM VALUE                   00030
.*                                                                      00031
.DBCK040 AIF   (T'&AM NE 'O').DBCK060   BRANCH IF &AM SPECIFIED         00032
         AIF   ('&MF' NE 'L').DBCK120   BRANCH IF NOT LIST FORM         00033
         IHBERMAC 1006,AM                                               00034
&ERR     SETB  1                                                        00035
         AGO   .DBCK140                                                 00036
.DBCK060 ANOP                                                           00037
&AMFC    SETC  '&AM'(1,1)               FIRST CHARACTER OF &AM          00038
         AIF   ('&AMFC' NE '(').DBCK080 BRANCH IF &AM TO BE CALCULATED  00039
         AIF   ('&MF' EQ 'L').DBCK100   BRANCH IF LIST FORM             00040
         AGO   .DBCK120                 &AM IS VALID                    00041
.DBCK080 ANOP                                                           00042
&AM0     SETB  ('&AM' EQ 'ISAM')                                        00043
&AM1     SETB  ('&AM' EQ 'BDAM')                                        00044
&AM2     SETB  ('&AM' EQ 'SAM' OR '&AM' EQ 'BPAM')                      00045
&AM3     SETB  ('&AM' EQ 'TAM')                                         00046
&AM4     SETB  ('&AM' EQ 'GAM')                                         00047
&AM5     SETB  ('&AM' EQ 'TCAM')                                        00048
&AM6     SETB  ('&AM' EQ 'EXCP')                                        00049
&AM7     SETB  0                                                        00050
         AIF   (&AM0 OR &AM1 OR &AM2 OR &AM3 OR &AM4 OR &AM5 OR &AM6   X00051
               OR &AM7).DBCK120         BRANCH IF &AM VALID             00052
.DBCK100 ANOP                                                           00053
&ERR     SETB  1                        SET ERROR INDICATOR             00054
         IHBERMAC 1001,AM,&AM                                           00055
.*                                                                      00056
.*                       ESTABLISH AND TEST &TYPE VALUE                 00057
.*                                                                      00058
.DBCK120 AIF   ('&MF' EQ 'L').DBCK140   BRANCH IF LIST FORM             00059
&TYPEA   SETB  ('&TYPE' EQ 'ADD')                                       00060
&TYPED   SETB  ('&TYPE' EQ 'DELETE')                                    00061
&TYPEP   SETB  ('&TYPE' EQ 'PURGE')                                     00062
.*                                      VERIFY IS DEFAULT TYPE          00063
&TYPEV   SETB  ('&TYPE' EQ 'VERIFY' OR T'&TYPE EQ 'O')                  00064
.*                                      BRANCH IF NO ERROR              00065
         AIF   (&TYPEA OR &TYPED OR &TYPEV OR &TYPEP).DBCK140           00066
         IHBERMAC 1001,TYPE,&TYPE                                       00067
         AGO   .DBCK160                 EXIT BECAUSE OF ERROR           00068
.DBCK140 AIF   (NOT &ERR).DBCK220       BRANCH IF NO SYNTAX ERRORS      00069
.*                                      GENERATE NAME IF NO CODE GENNED 00070
.*                                                                      00071
.*                       ERROR EXIT                                     00072
.*                                                                      00073
.DBCK160 AIF   ('&NAME' EQ '').DBCK200  DON'T GENERATE NAME IF NULL     00074
         AIF   ('&MF' NE 'L').DBCK180   BRANCH IF NOT LIST FORM         00075
&NAME    DS    0C                                                       00076
         MEXIT                                                          00077
.DBCK180 ANOP                                                           00078
&NAME    DS    0H                                                       00079
.DBCK200 MEXIT                                                          00080
.*                                                                      00081
.*                       ************                                   00082
.*                       * GENERATE *                                   00083
.*                       *   CODE   *                                   00084
.*                       ************                                   00085
.*                                                                      00086
.DBCK220 ANOP                                                           00087
&LABEL   SETC  '&NAME'                  SET LABEL FOR FIRST GENERATED   00088
         AIF   ('&MF' EQ 'L').DBCK340   BRANCH IF LIST FORM             00089
.*                                      LINE OF CODE                    00090
.*                                                                      00091
.*                       FUNCTION TYPE VALUE                            00092
.*                                                                      00093
.*                         VERIFY       0                               00094
.*                         ADD          1                               00095
.*                         DELETE       2                               00096
.*                         PURGE        3                               00097
.*                                                                      00098
         AIF   (&TYPEV).DBCK240         BRANCH IF VERIFY                00099
&A       SETA  &TYPEA*1+&TYPED*2+&TYPEP*3 SET AM TYPE                   00100
&LABEL   LA    0,&A                     LOAD TYPE VALUE                 00101
&LABEL   SETC  ''                       LABEL NOT TO BE GENERATED AGAIN 00102
.DBCK240 AIF   (T'&AM NE 'O').DBCK260   BRANCH IF &AM SPECIFIED         00103
         AIF   (NOT &TYPEV).DBCK420     BRANCH IF ADD OR DELETE TYPE    00104
&LABEL   SR    0,0                      LOAD TYPE AND AM VALUE          00105
         AGO   .DBCK420                                                 00106
.*                                                                      00107
.*                       ACCESS METHOD TYPE VALUE                       00108
.*                                                                      00109
.*                          ISAM        80                              00110
.*                          BDAM        40                              00111
.*                          SAM/BPAM    20                              00112
.*                          TAM         10                              00113
.*                          GAM         08                              00114
.*                          TCAM        04                              00115
.*                          EXCP        02                              00116
.*                          OMITTED     00                              00117
.*                                                                      00118
.DBCK260 ANOP                                                           00119
&REG     SETC  '0'                      INITIALIZE TO REG 0             00120
         AIF   (&TYPEV).DBCK280         BRANCH IF TYPE IS VERIFY        00121
&REG     SETC  '15'                     USE REG 15 IF ADD OR DELETE     00122
.DBCK280 AIF   ('&AMFC' NE '(').DBCK340 BRANCH IF &AM TO BE CALCULATED  00123
&AMSC    SETC  '&AM'(2,1)               SECOND CHARACTER OF &AM         00124
         AIF   ('&AMSC' EQ '(').DBCK320 BRANCH IF &AM A REGISTER        00125
.*                                                                      00126
.*                       &AM VALUE TO BE INSERTED FROM AN ADDRESS       00127
.*                                                                      00128
         AIF   (NOT &TYPEV).DBCK300     BRANCH IF NOT VERIFY            00129
&LABEL   SR    0,0                      LOAD TYPE VALUE                 00130
&LABEL   SETC  ''                       LABEL NOT TO BE GENERATED AGAIN 00131
.DBCK300 ANOP                                                           00132
&AMFC    SETC  '&AM(1)'                 ADDRESS OF AM VALUE             00133
&LABEL   ICM   0,8,&AMFC                INSERT AM VALUE IN HI BYTE      00134
         AGO   .DBCK420                                                 00135
.*                                                                      00136
.*                       &AM VALUE IN A REGISTER                        00137
.*                                                                      00138
.DBCK320 ANOP                                                           00139
&A       SETA  K'&AM-4                  LENGTH OF REGISTER              00140
&AMFC    SETC  '&AM'(3,&A)              REGISTER CONTAINING AM VALUE    00141
&LABEL   LR    &REG,&AMFC               LOAD AM VALUE                   00142
         AGO   .DBCK380                 GO TO SHIFT TO HIGH BYTE        00143
.*                                                                      00144
.*                       &AM VALUE TO BE CALCULATED                     00145
.*                                                                      00146
.DBCK340 ANOP                                                           00147
&A       SETA  128*&AM0+64*&AM1+32*&AM2+16*&AM3+8*&AM4+4*&AM5+2*&AM6    00148
         AIF   ('&MF' NE 'L').DBCK360   BRANCH IF NOT LIST FORM         00149
&NAME    DC    AL1(&A)                                                  00150
         MEXIT                                                          00151
.DBCK360 ANOP                                                           00152
&LABEL   LA    &REG,&A                  LOAD AM VALUE                   00153
.DBCK380 SLL   &REG,24                  SHIFT TO HIGH ORDER BYTE        00154
.DBCK400 AIF   (&TYPEV).DBCK420                                         00155
         OR    0,15                     OR AM TYPE INTO REGISTER 0      00156
.*                                                                      00157
.*                       LOAD CB ADDRESS AND SVC ROUTING ID             00158
.*                                                                      00159
.DBCK420 IHBINNRA &CBAD                 LOAD CBAD INTO REGISTER 1       00160
         LA    15,2                     DEBCHK SVC ID                   00161
         SVC   117                                                      00162
         MEND                                                           00163
*          DATA SET CBT380T    AT LEVEL 001 AS OF 06/09/77              00164
DEBE     TITLE 'OPERATING SYSTEM/360 MULTIFUNCTION UTILITY - VERSION 2' 00165
OSDEBE   START 0                                                        00166
*********************************************************************** 00167
*                                                                       00168
*  THE PURPOSE OF OSDEBE IS TO PROVIDE THE USER OF 360 OPERATING        00169
*  SYSTEM THE FLEXIBILITY OF THE ORIGINAL DEBE.  FLEXIBILITY CAN        00170
*  ONLY BE OBTAINED BY THE ELIMINATION OF DD CARDS.  ALL FUNCTIONS      00171
*  WHICH ARE AVAILABLE WITH BPS DEBE ARE PROVIDED IN OSDEBE.            00172
*  IN ADDITION, MANY NEW FEATURES HAVE BEEN ADDED; FOR A COMPLETE       00173
*  DESCRIPTION, SEE THE OSDEBE PROGRAM MANUAL.                          00174
*                                                                       00175
*********************************************************************** 00176
*                                                                       00177
*  CORE REQUIREMENTS - ABOUT 16K (K=1024), 8K OF WHICH IS USED          00178
*  AS AN I/O AREA FOR TAPE OPERATIONS.                                  00179
*                                                                       00180
*  ERROR RECOVERY - THE OPERATING SYSTEM PERFORMS ALL STANDARD          00181
*  ERROR RECOVERY.  IF IT CANNOT RECOVER FROM AN ERROR, OSDEBE          00182
*  WILL NOT EVEN TRY.                                                   00183
*                                                                       00184
*  ALL REPLIES TO OSDEBE ARE OF THE WTOR FORMAT,                        00185
*          REPLY 00,'TP'                                                00186
*  WHENEVER ANY INFORMATION IS REQUESTED BY OSDEBE, A REPLY OF          00187
*  'EJ' WILL TERMINATE THE SUBROUTINE OF OSDEBE.  A REPLY OF 'EJ'       00188
*  IN RESPONSE TO THE REQUEST FOR THE PROGRAM ID WILL TERMINATE         00189
*  OSDEBE AND CONTROL IS RETURNED TO THE OPERATING SYSTEM.              00190
*                                                                       00191
*  ONCE A ROUTINE IS RUNNING IN OSDEBE, IT CAN ONLY BE TERMINATED       00192
*  BY CANCELLING THE JOB, AND THE JOB MUST BE RESCHEDULED AGAIN.        00193
*  AN ALTERNATIVE TO CANCELLING THE JOB IS TO CAUSE AN I/O ERROR        00194
*  ON ONE OF THE UNITS BEING USED.  AN I/O ERROR WILL CAUSE THE         00195
*  SUBROUTINE OF OSDEBE TO TERMINATE, BUT OSDEBE WILL STILL BE          00196
*  IN CONTROL.                                                          00197
*                                                                       00198
*********************************************************************** 00199
         EJECT                                                          00200
*                                                                       00201
*  INITIALIZATION                                                       00202
*                                                                       00203
         USING  OSDEBE,15                                               00204
         B     AROUND                                                   00205
         DC    C'OSDEBE-REVISED: CONTACT SYSTEMS PROGRAMMING '          00206
         DC    C'IF ANY PROBLEMS.'                                      00207
K4096    DC    F'4096'                                                  00208
AROUND   DS    0H                                                       00209
         SAVE  (14,12)                                                  00210
BEGIN    BALR  12,0                                                     00211
         USING *,12,9                                                   00212
         LR    9,12                                                     00213
         A     9,K4096                                                  00214
BEGIN1   EQU   *                                                        00215
         LA    14,SAVEAREA                                              00216
         ST    13,SAVEAREA+4                                            00217
         ST    14,8(0,13)                                               00218
         LR    13,14                                                    00219
         MODESET KEY=ZERO,MODE=SUP     GET INTO SUP STATE        DAL    00220
         GETMAIN R,LV=564,SP=252                                        00221
         LR    8,1                                                      00222
         LA    3,TDAREA                                                 00223
         LA    3,80(3)  GET ADDRESS OF WORKAREA SKELETONS               00224
         MVC   0(232,8),0(3)                                            00225
         MVC   232(232,8),232(3)                                        00226
         USING WORKAREA,8                                               00227
         LA    3,INDEB                                                  00228
         ST    3,AET1                                                   00229
         LA    3,APPEND                                                 00230
         ST    3,AET2                                                   00231
         ST    3,AET3                                                   00232
         ST    3,AET4                                                   00233
         ST    3,AET5                                                   00234
         ST    3,AET6                                                   00235
         ST    3,AET14                                                  00236
         ST    3,AET15                                                  00237
         ST    3,AET16                                                  00238
         ST    3,AET17                                                  00239
         ST    3,AET18                                                  00240
         LA    3,OUTDEB                                                 00241
         ST    3,AET7-1                                                 00242
         MVI   AET7-1,X'04'                                             00243
         ST    3,AET13                                                  00244
         LA    3,INDCB                                                  00245
         ST    3,AET8-1                                                 00246
         MVI   AET8-1,X'0F'                                             00247
         ST    3,AET12                                                  00248
         LA    3,INIOVEC                                                00249
         ST    3,AET9-1                                                 00250
         MVI   AET9-1,X'02'                                             00251
         LA    3,INECB                                                  00252
         ST    3,AET10-1                                                00253
         MVI   AET10-1,X'7F'                                            00254
         LA    3,INCCW                                                  00255
         ST    3,AET11                                                  00256
         LA    3,OUTDCB                                                 00257
         ST    3,AET19-1                                                00258
         MVI   AET19-1,X'0F'                                            00259
         ST    3,AET23                                                  00260
         LA    3,OUTIOVEC                                               00261
         ST    3,AET20-1                                                00262
         MVI   AET20-1,X'02'                                            00263
         LA    3,OUTECB                                                 00264
         ST    3,AET21-1                                                00265
         MVI   AET21-1,X'7F'                                            00266
         LA    3,OUTCCW                                                 00267
         ST    3,AET22                                                  00268
         SPACE 5                                                        00269
*  GET CVT POINTER                                                      00270
         L     3,16                                                     00271
*  GET POINTER TO THE TCB POINTERS                                      00272
         L     2,0(0,3)                                                 00273
*  GET TCB POINTER                                                      00274
         L     3,4(0,2)                                                 00275
*  GET PROTECT KEY FROM TCB FOR THE DEB'S                               00276
         OC    INDEB+24(1),28(3)                                        00277
         OC    OUTDEB+24(1),28(3)                                       00278
*  GET TCB ADDRESS FOR THE DEB'S                                        00279
         ST    3,INDEB                                                  00280
         ST    3,OUTDEB                                                 00281
         L     11,8(,3)                ADDR OF TCB DEB QUEUE     DAL    00282
         LA    11,0(,11)               CLR HIGH BYTE NATCH       DAL    00283
         LTR   11,11                   NO DEBS ON QUEUE                 00284
         BNZ   CHKDEBAD                NO CHK DEBS FOR NEXT      DAL    00285
         IC    15,8(,3)                SAVE BYTE                 DAL    00286
         LA    1,INDEB                 ADR OF OUR FIRST DEB      DAL    00287
         ST    1,8(,3)                 STORE IT IN TCB           -AL    00288
         STC   15,8(,3)                RESTORE BYTE                     00289
         B     DEBCHK                  GO DO DEBCHK MACRO        DAL    00290
CHKDEBAD L     15,4(,11)               ADDR NEXT DEB                    00291
         LA    15,0(,15)               CLR HIGH                         00292
         LTR   15,15                   END OF CHAIN              DAL    00293
         BZ    STOREDEB                YES STORE DEB ADDR IN DEB DAL    00294
         LR    11,15                   NO CHK NEXT DEB                  00295
         B     CHKDEBAD                                                 00296
STOREDEB LA    1,INDEB                 ADDR OUR DEB                     00297
         IC    15,4(,11)               SAVE BYTE                 DAL    00298
         ST    1,4(,11)                STORE INTO PREV LAST DEB  DAL    00299
         STC   15,4(,11)               RETURN BYTE TO WHENCE T   DAL    00300
DEBCHK   EQU   *                                                        00301
         LA    11,OUTDCB               GET DCB ADDR              DAL    00302
         DEBCHK (11),TYPE=ADD          PUT DEB ON DEB TABLE      DAL    00303
         LA    11,INDCB                GET DCB ADDR              DAL    00304
         DEBCHK (11),TYPE=ADD          PUT DEB ON DEB TABLE      DAL    00305
     SPACE 2                                                            00306
*   GET SUBPOOL WORK AREA FOR TAPE I/O OPERATIONS                       00307
     SPACE 2                                                            00308
         GETMAIN  R,LV=32768,SP=0                                       00309
         ST    1,TAPEAREA        STORE ADDRESS OF TAPE WORK I/O AREA    00310
     SPACE 2                                                            00311
*  STORE THE ADDRESS IN THE TWO   TAPE CCW'S                            00312
     SPACE 2                                                            00313
         MVC   TDINCCW+1(3),TAPEAREA+1                                  00314
         MVC   TTCCWOUT+1(3),TAPEAREA+1                                 00315
         EJECT                                                          00316
*                                                                       00317
*  MAIN PROGRAM                                                         00318
*  ALL ROUTINES RETURN HERE WHEN THEY ARE FINISHED.                     00319
*                                                                       00320
ASKAGN   EQU   *                                                        00321
         NI    INIOB,X'3F'         TURN OFF CHAIN FLAGS IN IOB'S        00322
         NI    OUTIOB,X'3F'                                             00323
         SPACE 2                                                        00324
         NI    TD3+1,X'0F'   RESET SWITCHES SET IN TP ROUTINE           00325
         NI    TD6+1,X'0F'                                              00326
         SPACE 3                                                        00327
         WTOR  'DEBE: ENT PROG ID - XX',ID,2,REPLYECB                   00328
         BAL   11,WAITANS    GO WAIT FOR A REPLY                        00329
         OC    ID(2),BLANKS                                             00330
         CLC   ID(2),=C'EJ'  IS SHE DONE? - EOJ                         00331
         BE    EOJ           YES, RETURN TO THE OPERATING SYSTEM        00332
         CLC   ID(2),=C'BF'  BACKSPACE A FILE                           00333
         BE    BF                                                       00334
         CLC   ID(2),=C'BS'  BACKSPACE A NUMBER OF RECORDS              00335
         BE    BS                                                       00336
         CLC   ID(2),=C'BT'  BLOCK CARD IMAGE ON TAPE                   00337
         BE    BT                                                       00338
         CLC   ID(2),=C'CC'  CARD TO CARD                               00339
         BE    CC                                                       00340
         CLC   ID(2),=C'CP'  CARD TO PRINTER                            00341
         BE    CP                                                       00342
         CLC   ID(2),=C'CT'  CARD TO TAPE                               00343
         BE    CT                                                       00344
         CLC   ID(2),=C'DP'  LIST TAPE TO PRINTER                       00345
         BE    DP                                                       00346
         CLC   ID(2),=C'HD'  TAPE LABEL ONTO SYSTEM CONSOLE             00347
         BE    HD                                                       00348
         CLC   ID(2),=C'KC'  COUNT CARDS                                00349
         BE    KC                                                       00350
         CLC   ID(2),=C'KR'  COUNT RECORDS                              00351
         BE    KR                                                       00352
         CLC   ID(2),=C'OX'  BAD                                        00353
         BE    BADID                                                    00354
         CLC   ID(2),=C'RU'  REWIND AND UNLOAD                          00355
         BE    RU                                                       00356
         CLC   ID(2),=C'RW'  REWIND                                     00357
         BE    RW                                                       00358
         CLC   ID(2),=C'SF'  SPACE FORWARD FILE                         00359
         BE    SF                                                       00360
         CLC   ID(2),=C'SR'  SKIP # OF RECORDS FORWARD                  00361
         BE    SR                                                       00362
         CLC   ID(2),=C'TC'  TAPE TO CARD                               00363
         BE    TC                                                       00364
         CLC   ID(2),=C'TD'  TAPE TO PRINT HEX                          00365
         BE    TD                                                       00366
         CLC   ID(2),=C'TM'  WRITE TAPE MARK                            00367
         BE    TM                                                       00368
         CLC   ID(2),=C'TP'  TAPE TO PRINT HEX                          00369
         BE    TP                                                       00370
         CLC   ID(2),=C'TT'  TAPE TO TAPE                               00371
         BE    TT                                                       00372
         CLC   ID(2),=C'WT'  WRITE TO TAPE MARK                         00373
         BE    WT                                                       00374
         CLC   ID(2),=C'WL'  WRITE A LABEL                              00375
         BE    WL                                            *BW 7/76*  00376
*        CLC   ID(2),=C'XP'                                             00377
*        BE    BADID                                                    00378
*        CLC   ID(2),=C'XR'                                             00379
*        BE    BADID                                                    00380
*        CLC   ID(2),=C'XS'                                             00381
*        BE    BADID                                                    00382
*        CLC   ID(2),=C'XA'                                             00383
*        BE    BADID                                                    00384
*        CLC   ID(2),=C'XB'                                             00385
*        BE    BADID                                                    00386
BADID    WTO   'DEBE: BAD ID - TRY AGAIN'                               00387
         B     ASKAGN                                                   00388
         SPACE 3                                                        00389
EOJ      EQU   *                                                        00390
         LA    11,INDCB                DCB ADDR                  DAL    00391
         DEBCHK (11),TYPE=DELETE       DELETE DEB FROM DEB TABLE DAL    00392
         LA    11,OUTDCB               DCB ADDR                  DAL    00393
         DEBCHK (11),TYPE=DELETE       DELETE DEB FROM DEB TABLE DAL    00394
         L     1,16          CVT                                        00395
         L     1,0(,1)       TCB QUEUE                                  00396
         L     1,4(,1)       TCB ADDR                                   00397
         L     10,8(,1)      DEB QUEUE                                  00398
         LA    10,0(,10)     CLEAR HIGH BYTE                            00399
         LA    11,INDEB      ADDR OUR DEB ON DEB QUEUE                  00400
         CR    11,10         OUR DEB FIRST ON QUEUE                     00401
         BNE   CHKEND        NO CHK NEXT DEB ON QUEUE                   00402
         L     11,OUTDEB+4   YES GET OUR LAST DEB ON QUEUE              00403
         LA    11,0(,11)     CLEAR HIGH BYTE                            00404
         LTR   11,11         IF ZERO OUR DEB ONLY ONES ON QUEUE         00405
         BZ    STOREZER      YES ZERO OUT TCB DEB Q POINTER             00406
         MVC   9(3,1),OUTDEB+4   ELSE MOVE SYS DEB ADDR TO TCB          00407
         B     EOJA                                                     00408
STOREZER IC    10,8(,1)      SAVE BYTE OF TCB                           00409
         ST    11,8(,1)      PUT SYS DEB ADDR IN TCB                    00410
         STC   10,8(,1)      PUT BACK BYTE                              00411
         B     EOJA                                                     00412
CHKEND   L     1,4(,10)      NEXT DEB ON Q                              00413
         LA    1,0(,1)       CLEAR BYTE                                 00414
         CR    1,11          OUR DEB YET                                00415
         BE    CHKDEBND      YES PROCESS                                00416
         L     10,4(,10)     NO ,GET NEXT DEB ON QUEUE                  00417
         B     CHKEND        NO LOOK AT NEXT DEB                        00418
CHKDEBND L     15,OUTDEB+4   ADDR OF OUR LAST DEBS NEXT POINTER         00419
         LA    15,0(,15)     ZERO OUT BYTE                              00420
         IC    11,4(,10)     SAVE BYTE                                  00421
         ST    15,4(,10)     STORE ADDR OF NEXT INTO LAST DEB           00422
         STC   11,4(,10)     RESTORE BYTE                               00423
EOJA     EQU   *                                                        00424
         L     13,4(0,13)                                               00425
         RETURN (14,12),RC=0                                            00426
         EJECT                                                          00427
*                                                                       00428
*  SUBPROGRAMS CALLED BY ID                                             00429
*                                                                       00430
*  BACKSPACE A FILE ON TAPE                                             00431
         SPACE 1                                                        00432
BF       EQU   *                                                        00433
         BAL   10,TPOUTSET   DETERMINE WHICH TAPE UNIT AND SET UP       00434
         MVC   OUTCCW+8(8),BFCCW   MOVE IN THE BF CCW                   00435
         B    SFEXCP                                                    00436
         SPACE 1                                                        00437
*  FORWARD SPACE A FILE ON TAPE                                         00438
         SPACE 1                                                        00439
SF       EQU   *                                                        00440
         BAL   10,TPOUTSET   DETERMINE WHICH TAPE UNIT AND SET UP       00441
         MVC   OUTCCW+8(8),SFCCW   MOVE IN SF CCW                       00442
SFEXCP   EQU   *                                                        00443
         BAL   11,MULTGET                                               00444
SFLOOP   EQU   *                                                        00445
         BAL   11,IOOUT      GO EXECUTE THE CCW                         00446
         CLI   OUTECB,X'7F'  WAS EVERYTHING OK                          00447
         BNE   TAPERR                                                   00448
         BCT   10,SFLOOP          TRY AGAIN                             00449
         B     ASKAGN             ALL DONE                              00450
MULTGET  EQU   *                                                        00451
         ST    11,SV11            SAVE 11                               00452
         WTOR  'DEBE: NR FILES TO BE PROCESSED - XXXX',                +00453
               TDAREA,4,REPLYECB                                        00454
         BAL   11,WAITANS                                               00455
         OC    TDAREA(4),BLANKS                                         00456
         CLC   TDAREA(2),=C'EJ'                                         00457
         BE    ASKAGN             NEW ROUTINE                           00458
         OI    TDAREA+3,X'F0'                                           00459
         PACK  TDWK,TDAREA(4)     PACK NUMBER                           00460
         CVB   10,TDWK            MAKE NUMBER BINARY                    00461
         L     11,SV11                                                  00462
         BR    11                 RETURN                                00463
         EJECT                                                          00464
*  BACKSPACE NNNN RECORDS ON TAPE                                       00465
         SPACE 1                                                        00466
BS       EQU   *                                                        00467
         SPACE 1                                                        00468
*  SKIP NNNN RECORDS ON TAPE                                            00469
         SPACE 1                                                        00470
SR       EQU   *                                                        00471
         BAL   10,TPOUTSET   DETERMINE WHICH TAPE UNIT AND SET UP       00472
         WTOR  'DEBE: NR REC TO BE SKIPPED - XXXX',TDAREA,4,REPLYECB    00473
         BAL   11,WAITANS    GO WAIT FOR A REPLY                        00474
         OC    TDAREA(2),BLANKS                                         00475
         CLC   TDAREA(2),=C'EJ'  END THIS ROUTINE                       00476
         BE    ASKAGN        YES, EXIT THIS ROUTINE                     00477
         OI    TDAREA+3,X'F0'      MAKE A GOOD SIGN FOR CVB             00478
         PACK  TDWK,TDAREA(4)                                           00479
         CVB   2,TDWK        PUT NUMBER OF REC'S IN REG 2               00480
         CLC   ID(2),=C'SR'                                             00481
         BE    SREX                                                     00482
BSEX     MVC   OUTCCW+8(8),BSCCW   SET UP BS CCW                        00483
BSAGN    EQU   *                                                        00484
         BAL   11,IOOUT      EXECUTE THE CCW                            00485
         CLI   OUTECB,X'7F'  EVERYTHING OK                              00486
         BE    BCT6          YES, DO AGAIN TILL COUNT = 0               00487
         B     TAPERR        NO, END THIS ROUTINE                       00488
BCT6     EQU   *                                                        00489
         BCT   2,BSAGN       DECREMENT THE COUNT AND DO AGAIN           00490
         B     ASKAGN        ALL FINISHED WITH THIS ROUTINE             00491
SREX     MVC   OUTCCW+8(8),SRCCW   SET UP SR CCW                        00492
         B     BSAGN                                                    00493
         EJECT                                                          00494
*  CARD TO CARD REPRODUCE                                               00495
         SPACE 1                                                        00496
CC       EQU   *                                                        00497
         MVI   INMODSTK,X'41'      SET UP READER'S DCB                  00498
         MVI   INDEVT,X'43'                                             00499
         MVC   D1(3),READER1       USE STANDARD ADDRESS                 00500
         BAL   14,UCBLOKUP                                              00501
         ST    2,INDEBMOD    STORE UCB ADDRESS IN DEB                   00502
         MVI   OUTMDSTK,X'42'                                           00503
         MVI   OUTDEVT,X'43'                                            00504
         MVC   D1(3),PUNCH1        USE STANDARD ADDRESS                 00505
         BAL   14,UCBLOKUP                                              00506
         ST    2,OUTDEBMD    STORE UCB ADDRESS IN DEB                   00507
         MVC   INCCW(8),CP1CCW     SET UP READ CCW                      00508
         MVC   OUTCCW(8),S2CCW                                          00509
CCLOOP   EQU   *                                                        00510
         BAL   11,IOIN       READ A CARD                                00511
         CLI   INECB,X'7F'         EVERYTHING OK                        00512
         BE    CC1                 YES, BRANCH                          00513
         TM    INSTAT+4,X'01'    EOF                                    00514
         BC    1,PCHDN                                                  00515
         B     RDRERROR      READER ERROR, END THIS ROUTINE             00516
CC1      EQU   *                                                        00517
         BAL   11,IOOUT      PUNCH A CARD                               00518
         CLI   OUTECB,X'7F'        EVERYTHING OK                        00519
         BE    CCLOOP        YES, LOOP                                  00520
*                                                                       00521
PCHERROR WTO   'DEBE: PUNCH ERROR - EOJ'                                00522
PCHDN    EQU   *                                                        00523
         MVC   OUTCCW(8),ROCCW                                          00524
         LA    11,ASKAGN                                                00525
         B     IOOUT                                                    00526
         EJECT                                                          00527
*  CARD TO PRINTER - 80/80 LIST                                         00528
         SPACE 1                                                        00529
CP       EQU   *                                                        00530
*  SET UP READER'S DCB AND DEB                                          00531
         MVI   INMODSTK,X'41'                                           00532
         MVI   INDEVT,X'43'                                             00533
         MVC   D1(3),READER1       USE STANDARD ADDRESS                 00534
         BAL   14,UCBLOKUP                                              00535
         ST    2,INDEBMOD          STORE UCB ADDRESS IN DEB             00536
         BAL   11,OPENPRNT   OPEN SYSPRINT IF NOT OPEN                  00537
CP2      EQU   *                                                        00538
         BAL   11,SKIPTO1    SKIP TO CHANNEL 1                          00539
*  SET UP READER CCW                                                    00540
CPGO     MVC   INCCW(8),CP1CCW     SET UP READ CCW                      00541
CPLOOP   EQU   *                                                        00542
         BAL   11,IOIN       READ A CARD                                00543
         CLI   INECB,X'7F'   EVERYTHING OK                              00544
         BE    CP1           YES, BRANCH                                00545
         TM    INSTAT+4,X'01'      EOF?                                 00546
         BC    1,TDEOJ                                                  00547
RDRERROR WTO   'DEBE: READER ERROR - EOJ'                               00548
         B     ASKAGN                                                   00549
CP1      EQU   *                                                        00550
         MVC   TDOUTAR(80),TDAREA      CLEAR UPPER PRINT LINE AFTER     00551
         MVC   TDOUTAR+80(52),=CL52' ' MOVING DATA TO PRINT LINE        00552
         BAL   11,TDPRINT    PRINT A CARD                               00553
         B     CPLOOP        LOOP                                       00554
         EJECT                                                          00555
*  CARD TO TAPE                                                         00556
         SPACE 1                                                        00557
CT       EQU   *                                                        00558
*  SET UP READER'S DCB AND DEB                                          00559
         MVI   INMODSTK,X'41'                                           00560
         MVI   INDEVT,X'43'                                             00561
         MVC   D1(3),READER1       USE STANDARD ADDRESS                 00562
         BAL   14,UCBLOKUP                                              00563
         ST    2,INDEBMOD    STORE UCB ADDRESS IN DEB                   00564
         MVC   INCCW(8),CP1CCW     SET UP READ CCW                      00565
*  SET UP TAPE'S DCB AND DEB                                            00566
         BAL   10,TPOUTSET   DETERMINE WHICH TAPE UNIT AND SET UP       00567
         MVC   OUTCCW+8(8),CTCCW   SET UP WRITE CCW                     00568
         SR    2,2           CLEAR A COUNTER                            00569
CTLOOP   EQU   *                                                        00570
         BAL   11,IOIN       READ A CARD                                00571
         CLI   INECB,X'7F'         EVERYTHING OK                        00572
         BE    CT1           YES, BRANCH                                00573
         TM    INSTAT+4,X'01'      EOF                                  00574
         BC    1,CTEOJ                                                  00575
         B     RDRERROR      READER ERROR, END THIS ROUTINE             00576
CT1      EQU   *                                                        00577
         LA    2,1(2)        INCREMENT A COUNTER                        00578
         BAL   11,IOOUT      WRITE TO TAPE                              00579
         CLI   OUTECB,X'7F'        EVERYTHING OK                        00580
         BE    CTLOOP        YES, LOOP                                  00581
         SPACE 1                                                        00582
*  IF OS CAN'T RECOVER FROM THE ERROR, I SURELY WON'T TRY               00583
         B     TAPERR                                                   00584
CTEOJ    EQU   *                                                        00585
         BAL   11,WTM                                                   00586
         B     ASKAGN                                                   00587
         EJECT                                                          00588
* LIST TAPE (DEBLOCKED) ON PRINTER                                      00589
         SPACE 1                                                        00590
DP       EQU   *                                                        00591
         BAL   11,OPENPRNT        OPEN PRINTER                          00592
         BAL   11,SKIPTO1         RESTORE CARRIAGE                      00593
         BAL   10,TAPINSET        GET A TAPE                            00594
         MVC   INCCW+8(8),TDINCCW                                       00595
         BAL   11,TDPRINT         PRINT HEADER                          00596
         BAL   11,SPACE1                                                00597
         WTOR  'DEBE: ENT LRECL - XXXX',TDAREA,4,REPLYECB               00598
         BAL   11,WAITANS                                               00599
         OC    TDAREA(4),BLANKS   SHIFT TO UPPER CASE                   00600
         CLC   TDAREA(2),=C'EJ'                                         00601
         BE    ASKAGN                                                   00602
         OI    TDAREA+3,X'F0'     MAKE A BINARY NUMBER                  00603
         PACK  TDWK,TDAREA(4)                                           00604
         CVB   4,TDWK                                                   00605
         BAL   10,TAPEBLOK                                              00606
DPLOOP1  EQU   *                                                        00607
         SR    2,2                                                      00608
         BAL   11,IOIN            READ A TAPE RECORD                    00609
         CLI   INECB,X'7F'        OK?                                   00610
         BE    DP1                                                      00611
         TM    INSTAT+4,X'01'     EOF?                                  00612
         BC    1,TDEOJ                                                  00613
         B     TAPERROR                                                 00614
DP1      EQU   *                                                        00615
         LH    10,INSTAT+6        RES COUNT                             00616
         LH    3,TDINCCW+6        REQUESTED                             00617
         SR    3,10               GET LENGTH                            00618
DPLOOP2  EQU   *                                                        00619
         L     10,TAPEAREA    GET ADDRESS OF SP 0 WORK AREA             00620
         AR    10,2                                                     00621
         MVC   TDOUTAR(132),BLANKS                                      00622
         LR    5,4                                                      00623
         BCTR  5,0                DECREMENT GR5                         00624
         EX    5,DPMVC            *MVC TDOUTAR(L),0(10)                 00625
         BAL   11,TDPRINT         PRINT LINE                            00626
         AR    2,4                UP POINTER                            00627
         CR    2,3                DONE?                                 00628
         BL    DPLOOP2                                                  00629
         TM    NBRSW,X'FF'                                              00630
         BO    DPLOOP1                                                  00631
         BCT   6,DPLOOP1                                                00632
         B     TDEOJ                                                    00633
DPMVC    MVC   TDOUTAR(0),0(10)                                         00634
         EJECT                                                          00635
* BLOCK CARDIMAGE ON TAPE                                               00636
         SPACE 1                                                        00637
BT       EQU   *                                                        00638
         MVI   INMODSTK,X'41'     PRIME CONTROL BLOCKS                  00639
         MVI   INDEVT,X'43'                                             00640
         MVC   D1(3),READER1                                            00641
         BAL   14,UCBLOKUP                                              00642
         ST    2,INDEBMOD                                               00643
         MVC   INCCW(8),CP1CCW                                          00644
         BAL   10,TPOUTSET        GET OUTPUT TAPE                       00645
         MVC   OUTCCW+8(8),TTCCWOUT                                     00646
         WTOR  'DEBE: ENT BLK FACTOR - XXXX',TDAREA,4,REPLYECB          00647
         BAL   11,WAITANS                                               00648
         OC    TDAREA(4),BLANKS                                         00649
         CLC   TDAREA(2),=C'EJ'                                         00650
         BE    ASKAGN                                                   00651
         OI    TDAREA+3,X'F0'                                           00652
         PACK  TDWK,TDAREA(4)                                           00653
         CVB   2,TDWK             PUT IN GR2                            00654
         MH    2,=H'80'                                                 00655
BTLOOP1  EQU   *                                                        00656
         SR    4,4                                                      00657
         LA    3,TDAREA                                                 00658
BTLOOP2  EQU   *                                                        00659
         ST    3,TDWK                                                   00660
         MVC   INCCW+1(3),TDWK+1                                        00661
         BAL   11,IOIN            READ A CARD                           00662
         CLI   INECB,X'7F'        OPERATION OK?                         00663
         BE    BT1                                                      00664
         TM    INSTAT+4,X'01'     EOF?                                  00665
         BC    1,BTEOJ                                                  00666
         B     RDRERROR                                                 00667
BT1      EQU   *                                                        00668
         LA    3,80(3)            MOVE POINTER                          00669
         LA    4,80(4)            INCR COUNTER                          00670
         CR    2,4                                                      00671
         BNE   BTLOOP2            TRY AGAIN                             00672
         STH   4,OUTCCW+14        COUNT FIELD                           00673
         BAL   11,IOOUT           WRITE TAPE                            00674
         CLI   OUTECB,X'7F'       OK?                                   00675
         BNE   TAPERR                                                   00676
         B     BTLOOP1            PRAY WE GET OUT OF THIS LOOP!         00677
BTEOJ    EQU   *                                                        00678
         LTR   4,4                                                      00679
         BZ    CTEOJ                                                    00680
         STH   4,OUTCCW+14                                              00681
         BAL   11,IOOUT                                                 00682
         CLI   OUTECB,X'7F'       OPERATION OK?                         00683
         BNE   TAPERR                                                   00684
         B     CTEOJ              WRITE T/M                             00685
         EJECT                                                          00686
*  TAPE TO CARD, DEBLOCKING                                             00687
         SPACE 1                                                        00688
TC       EQU   *                                                        00689
         BAL   10,TAPINSET         SET UP TAPE                          00690
         MVC   INCCW+8(8),TDINCCW  SET UP READ CCW                      00691
         MVI   OUTDEVT,X'43'                                            00692
         MVI   OUTMDSTK,X'42'                                           00693
         MVC   D1(3),PUNCH1                                             00694
         BAL   14,UCBLOKUP                                              00695
         ST    2,OUTDEBMD                                               00696
         MVC   OUTCCW(8),DBCCW     PRIME CCW                            00697
DBLOOP1  EQU   *                                                        00698
         SR    2,2                                                      00699
         BAL   11,IOIN             READ A RECORD                        00700
         CLI   INECB,X'7F'         OK?                                  00701
         BE    DB1                 YES, BRANCH                          00702
         TM    INSTAT+4,X'01'      EOF?                                 00703
         BC    1,PCHDN                                                  00704
         B     TAPERROR                                                 00705
DB1      EQU   *                                                        00706
         LH    10,INSTAT+6         GET RES CNT                          00707
         LH    3,TDINCCW+6         GET START CNT                        00708
         SR    3,10                GET LENGTH                           00709
DBLOOP2  L     10,TAPEAREA    GET ADDRESS OF SP 0 WORK AREA             00710
         AR    10,2                                                     00711
         MVC   TDAREA2(80),0(10)                                        00712
         BAL   11,IOOUT            PUNCH CARD                           00713
         CLI   OUTECB,X'7F'        OK?                                  00714
         BNE   PCHERROR            NO, BRANCH                           00715
         LA    2,80(2)             MOVE POINTER                         00716
         CR    2,3                 DONE?                                00717
         BL    DBLOOP2             NO, GO AGAIN                         00718
         B     DBLOOP1             NEXT RECORD                          00719
         EJECT                                                          00720
*  PRINT A TAPE                                                         00721
         SPACE 1                                                        00722
TP       EQU   *                                                        00723
*  TP USES THE TD ROUTINE WITHOUT THE HEX-TO-CHARACTER CONVERSION       00724
         OI    TD3+1,X'F0'         SET SWITCHES IN TD                   00725
         OI    TD6+1,X'F0'                                              00726
         SPACE 1                                                        00727
*  PRINT A TAPE IN HEX UNLESS SWITCHES SET BY TP                        00728
         SPACE 1                                                        00729
TD       EQU   *                                                        00730
         BAL   11,OPENPRNT   OPEN SYSPRINT IF NECESSARY                 00731
         BAL   11,SKIPTO1     SKIP TO CHANNEL 1                         00732
*  SET UP TAPE'S DCB AND DEB                                            00733
         BAL   10,TAPINSET         DETERMINE WHICH TAPE UNIT AND SET UP 00734
         MVC   INCCW+8(8),TDINCCW  SET UP READ CCW                      00735
         BAL   11,TDPRINT    PRINT THE HEADING LINE                     00736
         BAL   11,SPACE1      SPACE A LINE                              00737
         SP    RECCNT(3),RECCNT(3) CLEAR THE RECORD COUNTER             00738
         BAL   10,TAPEBLOK                                              00739
TDLOOP   EQU   *                                                        00740
         BAL   11,IOIN        READ A RECORD                             00741
         CLI   INECB,X'7F'         EVERYTHING OK                        00742
         BE    TD1           YES, BRANCH                                00743
         TM    INSTAT+4,X'01'      EOF                                  00744
         BC    1,TDEOJ       YES, GO END ROUTINE                        00745
         SPACE 1                                                        00746
*  IF OS CAN'T RECOVER FROM THE ERROR, I SURELY WON'T TRY               00747
         B     TAPERROR                                                 00748
TD1      LH    2,INSTAT+6          GET RESIDUAL COUNT                   00749
         LH    3,TDINCCW+6         GET BEGINING COUNT                   00750
         SR    3,2                 GET BYTES READ IN                    00751
         CVD   3,TDWK                                                   00752
         MVI   TDOUTAR,C' '        CLEAR PRINT LINE                     00753
         MVC   TDOUTAR+1(131),TDOUTAR                                   00754
         MVC   TDOUTAR+102(23),RECHDG  SET UP LINE INFORMATION          00755
         ED    TDOUTAR+119(6),TDWK+5                                    00756
         AP    RECCNT(3),COND1(1)      INCREMENT RECORD COUNTER         00757
         ED    TDOUTAR+105(6),RECCNT                                    00758
*     GET READY FOR HEX CONVERSION                                      00759
         L     2,TAPEAREA   GET ADDRESS OF SP 0 WORKAREA                00760
         L     5,TAPEAREA   GET ADDRESS OF SP 0 WORKAREA                00761
         LA    7,100                                                    00762
TD6      BC    0,TD7         SET TO BRANCH BY TP ROUTINE                00763
*  R2 POINTS TO THE INPUT AREA                                          00764
*  R5 POINTS TO THE OUTPUT AREA                                         00765
         L     5,=A(TDAREA2)                                            00766
         LA    7,50                                                     00767
         BAL   14,UNPK       GO CONVERT 50 BYTES TO 100 HEX             00768
TD7      EQU   *                                                        00769
         CR    3,7           SHORT LINE TO BE PRINTED                   00770
         BL    TD3           YES, GO DO THE MOVE                        00771
         MVC   TDOUTAR(100),0(5)   ELSE DO 100 BYTE MOVE                00772
TDPR     EQU   *                                                        00773
         BAL   11,TDPRINT     PRINT A LINE                              00774
         MVI   TDOUTAR,C' '        CLEAR OUTPUT AREA                    00775
         MVC   TDOUTAR+1(131),TDOUTAR                                   00776
         SR    3,7           DECREMENT BLKSIZE                          00777
         BC    12,TD9         BRANCH IF BLOCK FINISHED                  00778
         AR    2,7            ELSE, INCREMENT COUNTERS                  00779
         AR    5,7                                                      00780
         B     TD6           AND LOOP                                   00781
TD3      BC    0,TD4         SET TO BRANCH BY TP ROUTINE                00782
         LR    11,3          GET REMAINDER OF DATA IN 11                00783
         AR    11,3          DOUBLE IT BECAUSE IT'S UNPACKED            00784
         BCTR  11,0          DECREMENT ONE FOR THE MOVE                 00785
         EX    11,MVCOML                                                00786
         B     TDPR          GO PRINT SHORT LINE                        00787
TD4      EQU   *                                                        00788
         BCTR  3,0                                                      00789
         EX    3,MVCOML                                                 00790
         B     TDPR           GO PRINT SHORT LINE                       00791
MVCOML   MVC   TDOUTAR(0),0(5)        COMMON MOVE INSTRUCTION           00792
UNPK     EQU   *             CONVERT 50 BYTES TO 100 BYTES HEX          00793
         UNPK  0(15,5),0(8,2)                                           00794
         UNPK  14(15,5),7(8,2)                                          00795
         UNPK  28(15,5),14(8,2)                                         00796
         UNPK  42(15,5),21(8,2)                                         00797
         UNPK  56(15,5),28(8,2)                                         00798
         UNPK  70(15,5),35(8,2)                                         00799
         UNPK  84(15,5),42(8,2)                                         00800
         UNPK  98(3,5),49(2,2)                                          00801
         TR    0(100,5),TDPTABLE-240                                    00802
         BR    14                                                       00803
TD9      EQU   *                                                        00804
         BAL   11,SPACE1     SPACE A LINE AFTER WHOLE BLOCKED           00805
         TM    NBRSW,X'FF'                                              00806
         BO    TDLOOP                                                   00807
         BCT   6,TDLOOP                                                 00808
TDEOJ    EQU   *                                                        00809
         BAL   11,SKIPTO1                                               00810
         B     ASKAGN                                                   00811
         EJECT                                                          00812
*  TAPE TO TAPE COPY                                                    00813
         SPACE 1                                                        00814
TT       EQU   *                                                        00815
         BAL   10,TPOUTSET    DETERMINE WHICH TAPE UNIT AND SET UP      00816
         BAL   10,TAPINSET    DETERMINE WHICH TAPE UNIT AND SET UP      00817
         MVC   INCCW+8(8),TDINCCW  SET UP READ CCW                      00818
         BAL   10,TAPEBLOK                                              00819
         BAL   11,MULTGET         GET FACTOR                            00820
TTLOOP   EQU   *                                                        00821
         BAL   11,IOIN        READ A BLOCK                              00822
         CLI   INECB,X'7F'                                              00823
         BE    TT1           EVERYTHING OK, BRANCH                      00824
         TM    INSTAT+4,X'01'                                           00825
         BC    1,TTEST                                                  00826
         SPACE 1                                                        00827
*  IF OS CAN'T RECOVER FROM THE ERROR, I SURELY WON'T TRY               00828
TAPERROR EQU   *                                                        00829
         WTO   'DEBE: INPUT TAPE ERROR - EOJ'                           00830
         B     ASKAGN                                                   00831
TT1      LH    2,INSTAT+6          GET RESIDUAL COUNT                   00832
         LH    3,TDINCCW+6         GET BEGINNING COUNT                  00833
         SR    3,2           COMPUTE BYTES READ IN                      00834
         STH   3,TTCCWOUT+6        SET UP WRITE CCW                     00835
         MVC   OUTCCW+8(8),TTCCWOUT                                     00836
         BAL   11,IOOUT      WRITE A BLOCK                              00837
         CLI   OUTECB,X'7F'        EVERYTHING OK                        00838
         BNE   TTERR                                                    00839
         TM    NBRSW,X'FF'                                              00840
         BO    TTLOOP                                                   00841
         BCT   6,TTLOOP                                                 00842
         B     ASKAGN                                                   00843
TTERR    EQU   *                                                        00844
         SPACE 1                                                        00845
*  IF OS CAN'T RECOVER FROM THE ERROR, I SURELY WON'T TRY               00846
TAPERR   EQU   *                                                        00847
         WTO   'DEBE: OUTPUT TAPE ERROR - EOJ'                          00848
         B     ASKAGN                                                   00849
TTEST    EQU   *                                                        00850
         LA    11,TTLOOP                                                00851
         BCT   10,WTM                                                   00852
         B     CTEOJ                                                    00853
         EJECT                                                          00854
*      TYPE TAPE HEADER LABELS ONTO SYSTEM CONSOLE                      00855
HD       EQU   *                                                        00856
         BAL   10,TAPINSET   WHICH TAPE UNIT                            00857
         MVC   INCCW+8(8),TDINCCW                                       00858
         MVI   HDRCTR,X'1C'         RESET HEADER COUNTER                00859
HDRLOOP  EQU   *                                                        00860
         BAL   11,IOIN                                                  00861
         CLI   INECB,X'7F'                                              00862
         BE    HDREADOK                                                 00863
         TM    INSTAT+4,X'01'                                           00864
         BC    1,HDREOJ                                                 00865
         B     TAPERROR                                                 00866
HDREADOK EQU   *                                                        00867
         L     11,TAPEAREA   GET ADDRESS OF TAPE INPUT AREA             00868
         MVC   TYPER+8(80),0(11)  MOVE FIRST 80 CHARS TO WTO MESSAGE    00869
TYPER    WTO   '                                                       X00870
               TEST LINE                '                               00871
         AP    HDRCTR(1),HDRCTR+1(1)      ADD ONE TO HEADER COUNTER     00872
         CP    HDRCTR(1),HDRCTR+2(1)    CHECK FOR END OF LOOP           00873
         BNH   HDRLOOP                                                  00874
HDREOJ   B     ASKAGN                                                   00875
HDRCTR   DC    P'1',P'1',P'3'                                           00876
         DS    0H                                                       00877
    SPACE   5                                                           00878
*OX      EQU   *   TURN OFF THE OFFLINE PROHIBITION        **BW SIK**   00879
*        NI    OFLNTEST+1,X'0F'  TURN OF BR AT OFFLINE TEST**BW SIK**   00880
*        B     ASKAGN                                      **BW SIK**   00881
         SPACE 5                                                        00882
RU       EQU   *                                                        00883
         BAL   10,TPOUTSET                                              00884
         MVC   OUTCCW+8(8),RUCCW                                        00885
         BAL   11,IOOUT                                                 00886
         B     ASKAGN                                                   00887
         SPACE 3                                                        00888
RW       EQU   *                                                        00889
         BAL   10,TPOUTSET         DETERMINE WHICH TAPE UNIT AND SET UP 00890
         MVC   OUTCCW+8(8),RWCCW   SET UP REWIND CCW                    00891
         BAL   11,IOOUT            EXECUTE THE REWIND                   00892
         B     ASKAGN                                                   00893
         SPACE 3                                                        00894
WT       EQU   *                                                        00895
         BAL   10,TPOUTSET     DETERMINE WHICH TAPE UNIT AND SET UP     00896
         B     CTEOJ         GO WRITE A TAPE MARK                       00897
         SPACE 3                                                        00898
TM       EQU   *                                                        00899
         BAL   10,TPOUTSET                                              00900
         BAL   11,MULTGET                                               00901
TM1      EQU   *                                                        00902
         BAL   11,WTM                                                   00903
         BCT   10,TM1                                                   00904
         B     ASKAGN                                                   00905
         SPACE 3                                                        00906
KR       EQU   *                                                        00907
         BAL   10,TAPINSET                                              00908
         MVC   INCCW+8(8),TDINCCW                                       00909
         B     KNTR                                                     00910
         SPACE 3                                                        00911
KC       EQU   *                                                        00912
         MVI   INMODSTK,X'41'                                           00913
         MVI   INDEVT,X'43'                                             00914
         MVC   D1(3),READER1                                            00915
         BAL   14,UCBLOKUP                                              00916
         ST    2,INDEBMOD                                               00917
         MVC   INCCW(8),CP1CCW                                          00918
         B     KNTR                                                     00919
WL       EQU   *              WRITE A TAPE LABEL            *BW 7/76*   00920
         BAL   10,TPOUTSET    REQUEST OUTPUT TAPE           *BW 7/76*   00921
         MVC   OUTCCW+8(8),RWCCW  MOVE IN REWIND CCW        *BW 7/76*   00922
         OI    OUTCCW+12,X'60'    SET CMD CHAIN & SLI FLAG  *BW 7/76*   00923
         MVC   OUTCCW+16(8),=X'0300000020000001' NO-OP      *BW 7/76*   00924
         BAL   11,IOOUT       GO DO REWIND                  *BW 7/76*   00925
         SPACE 1                                            *BW 7/76*   00926
*   WRITE VOL TAPE LABEL                                    *BW 7/76*   00927
         SPACE 1                                            *BW 7/76*   00928
         MVI   TDAREA,X'40'   CLEAR I/O AREA                *BW 7/76*   00929
         MVC   TDAREA+1(79),TDAREA                          *BW 7/76*   00930
         WTOR  'DEBE: REPLY VOLID - XXXXXX',TDAREA+4,6,     *BW 7/76*  X00931
               REPLYECB                                     *BW 7/76*   00932
         BAL   11,WAITANS                                   *BW 7/76*   00933
         WTOR  'DEBE: REPLY OWNER ID - CCCCCCCCC',          *BW 7/76*  X00934
               TDAREA+41,10,REPLYECB                        *BW 7/76*   00935
         BAL   11,WAITANS                                   *BW 7/76*   00936
         MVC   TDAREA(4),=C'VOL1'                           *BW 7/76*   00937
         MVI   TDAREA+10,X'F0'  NO SECURITY FLAG            *BW 7/76*   00938
         MVC   OUTCCW+8(8),CTCCW  MOVE IN WRITE CCW         *BW 7/76*   00939
         BAL   11,IOOUT                                     *BW 7/76*   00940
         SPACE 1                                            *BW 7/76*   00941
*   WRITE DUMMY HEADER LABEL                                *BW 7/76*   00942
         SPACE 1                                            *BW 7/76*   00943
         MVC   TDAREA(3),=C'HDR'                            *BW 7/76*   00944
         MVI   TDAREA+4,X'F0' ZERO OUT REST OF LABEL        *BW 7/76*   00945
         MVC   TDAREA+5(75),TDAREA+4                        *BW 7/76*   00946
         BAL   11,IOOUT       WRITE DUMMY TAPE LABEL        *BW 7/76*   00947
         SPACE 1                                            *BW 7/76*   00948
*   WRITE A TAPE MARK AND EXIT                              *BW 7/76*   00949
         SPACE 1                                            *BW 7/76*   00950
         B     CTEOJ                                        *BW 7/76*   00951
         EJECT                                                          00952
*XP      EQU   *                                           **BW SIK**   00953
*        WTOR  'DEBE: ENT NEW PUNCH ADDR - XXX',HOLD,3,REPLYECB SIK**   00954
*        BAL   11,WAITANS                                  **BW SIK**   00955
*        OC    HOLD(3),BLANKS                              **BW SIK**   00956
*        CLC   HOLD(2),=C'EJ'                              **BW SIK**   00957
*        BE    ASKAGN                                      **BW SIK**   00958
*        MVC   PUNCH1(3),HOLD                              **BW SIK**   00959
*        B     ASKAGN                                      **BW SIK**   00960
*        SPACE 3                                           **BW SIK**   00961
*XR      EQU   *                                           **BW SIK**   00962
*        WTOR  'DEBE: ENT NEW READER ADDR - XXX',HOLD,3,REPLYECB IK**   00963
*        BAL   11,WAITANS                                  **BW SIK**   00964
*        OC    HOLD(3),BLANKS                              **BW SIK**   00965
*        CLC   HOLD(2),=C'EJ'                              **BW SIK**   00966
*        BE    ASKAGN                                      **BW SIK**   00967
*        MVC   READER1(3),HOLD                             **BW SIK**   00968
*        B     ASKAGN                                      **BW SIK**   00969
*        SPACE 3                                           **BW SIK**   00970
*XS      EQU   *                                           **BW SIK**   00971
*        WTOR  'DEBE: ENT NEW PRINT ADDR - XXX',HOLD,3,REPLYECB SIK**   00972
*        BAL   11,WAITANS                                  **BW SIK**   00973
*        OC    HOLD(3),BLANKS                              **BW SIK**   00974
*        CLC   HOLD(2),=C'EJ'                              **BW SIK**   00975
*        BE    ASKAGN                                      **BW SIK**   00976
*        MVC   PRINT1(3),HOLD                              **BW SIK**   00977
*        B     ASKAGN                                      **BW SIK**   00978
*XA      EQU   *                                           **BW SIK**   00979
*        OI    SYSPRTSW,X'FF'                              **BW SIK**   00980
*        B     ASKAGN                                      **BW SIK**   00981
*XB      EQU   *                                           **BW SIK**   00982
*        XC    SYSPRTSW(1),SYSPRTSW                        **BW SIK**   00983
*        B     ASKAGN                                      **BW SIK**   00984
         EJECT                                                          00985
*                                                                       00986
*  SUBROUTINES USED BY THE SUBPROGRAMS CALLED BY ID                     00987
*                                                                       00988
*  OPEN PRINT FILE                                                      00989
         SPACE 1                                                        00990
OPENPRNT EQU   *                                                        00991
         TM    SYSPRTSW,X'FF'                                           00992
         BNO   OPSYSPR                                                  00993
         MVI   OUTMDSTK,X'09'     PRIME DCB                             00994
         MVI   OUTDEVT,X'48'                                            00995
         MVC   D1(3),PRINT1       PRINTER ADDRESS                       00996
         BAL   14,UCBLOKUP                                              00997
         ST    2,OUTDEBMD         STORE IN DEB                          00998
         B     OPENOK                                                   00999
OPSYSPR  EQU   *                                                        01000
         TM    OPENSW,X'FF'                                             01001
         BC    1,OPENOK                                                 01002
         OPEN  (PRINT,OUTPUT)                                           01003
         OI    OPENSW,X'FF'                                             01004
*                                                          **BW SIK**   01005
*    ASK FOR PRINTOUT DESTINATION                          **BW SIK**   01006
*                                                          **BW SIK**   01007
         ST    11,SAV11                                    **BW SIK**   01008
         WTOR  'DEBE: ENTER MESSAGE TO IDENTIFY PRINTOUT DESTINATION - X01009
               UP TO 30 CHARS',HEADERX,30,REPLYECB         **BW SIK**   01010
         BAL   11,WAITANS                                               01011
         MVC   TDOUTAR(100),HEADER     MOVE HDR FOR PRINT  **BW SIK**   01012
*                                                          **BW SIK**   01013
         LA    7,45                    SET UP PRINT LOOP   **BW SIK**   01014
*                                                          **BW SIK**   01015
HDRLP    EQU   *                                           **BW SIK**   01016
         MVI   TDA,X'40'                                   **BW SIK**   01017
         PUT   PRINT,TDA                                   **BW SIK**   01018
         BCT   7,HDRLP                                     **BW SIK**   01019
         L     11,SAV11                                    **BW SIK**   01020
OPENOK   EQU   *                                                        01021
         BR    11                                                       01022
SAVER9   DS    F                                           **BW SIK**   01023
         SPACE 3                                                        01024
*  COMMON PRINT ROUTINE                                                 01025
         SPACE 1                                                        01026
TDPRINT  EQU   *                                                        01027
         ST    11,SV11                                                  01028
         TR    TDOUTAR(132),PRNTABLE   ELIMINATE UNPRINTABLE CHARS.     01029
         TM    SYSPRTSW,X'FF'                                           01030
         BO    TDPRT1                                                   01031
         MVI   TDA,X'09'                                                01032
         PUT   PRINT,TDA                                                01033
         B     LINECT                                                   01034
TDPRT1   EQU   *                                                        01035
         MVC   OUTCCW(8),PTCCW                                          01036
         BAL   11,IOOUT           PRINT LINE                            01037
         CLI   OUTECB,X'7F'       PRINT OK?                             01038
         BNE   PTERROR            NO, BRANCH                            01039
         B     LINECT                                                   01040
         SPACE 1                                                        01041
*  SKIP PRINTER TO CHANNEL 1                                            01042
         SPACE 1                                                        01043
         BR    11                                                       01044
SKIPTO1  EQU   *                                                        01045
         ST    11,SAV11           SAVE RETURN ADCON                     01046
         TM    SYSPRTSW,X'FF'                                           01047
         BO    SKTO1                                                    01048
         MVI   TDA,X'89'                                                01049
         MVI   TDOUTAR,C' '                                             01050
         MVC   TDOUTAR+1(131),TDOUTAR                                   01051
         PUT   PRINT,TDA                                                01052
         B     SKTO1A                                                   01053
SKTO1    EQU   *                                                        01054
         MVC   OUTCCW(8),SKCCW                                          01055
         BAL   11,IOOUT           SKIP TO CHANNEL 1                     01056
         CLI   OUTECB,X'7F'       SKIP OK?                              01057
         BNE   PTERROR            NO, BRANCH                            01058
SKTO1A   EQU   *                                                        01059
         SR    0,0                CLEAR COUNTER                         01060
         STH   0,C                                                      01061
         L     11,SAV11                                                 01062
         BR    11                 RETURN                                01063
         SPACE 1                                                        01064
*  SPACE PRINTER ONE LINE                                               01065
         SPACE 1                                                        01066
SPACE1   EQU   *                                                        01067
         ST    11,SV11                                                  01068
         TM    SYSPRTSW,X'FF'                                           01069
         BO    SPC1                                                     01070
         MVI   TDA,X'09'                                                01071
         MVI   TDOUTAR,C' '                                             01072
         MVC   TDOUTAR+1(131),TDOUTAR                                   01073
         PUT   PRINT,TDA                                                01074
         B     LINECT                                                   01075
SPC1     EQU   *                                                        01076
         MVC   OUTCCW(8),SPCCW                                          01077
         BAL   11,IOOUT           SKIP LINE                             01078
         CLI   OUTECB,X'7F'       SKIP OK?                              01079
         BNE   PTERROR                                                  01080
LINECT   EQU   *                                                        01081
         LH    1,C                UPDATE LINE COUNT                     01082
         LA    0,1(1)                                                   01083
         STH   0,C                                                      01084
         L     11,SV11                                                  01085
         CH    0,CLIMIT           END OF PAGE                           01086
         BH    SKIPTO1                                                  01087
         BR    11                 EXIT ROUTINE                          01088
PTERROR  EQU   *                                                        01089
         WTO   'DEBE: PRINT ERROR - EOJ'                                01090
         B     ASKAGN                                                   01091
         SPACE 3                                                        01092
*  RECORD COUNTER                                                       01093
         SPACE 1                                                        01094
KNTR     EQU   *                                                        01095
         SR    2,2                                                      01096
KNTLOOP  EQU   *                                                        01097
         BAL   11,IOIN                                                  01098
         CLI   INECB,X'7F'                                              01099
         BE    KNT1                                                     01100
         TM    INSTAT+4,X'01'                                           01101
         BC    1,KNTDN                                                  01102
         CLC   ID(2),=C'KC'                                             01103
         BE    RDRERROR                                                 01104
         B     TAPERROR                                                 01105
KNT1     EQU   *                                                        01106
         LA    2,1(2)                                                   01107
         B     KNTLOOP                                                  01108
KNTDN    EQU   *                                                        01109
         MVC   COUNT(6),=X'402020202020'                                01110
         CVD   2,TDWK                                                   01111
         ED    COUNT(6),TDWK+5                                          01112
         LA    1,MESSAGE                                                01113
         SVC   35                                                       01114
         B     ASKAGN                                                   01115
         EJECT                                                          01116
*  ROUTINE TO CONVERT MM INTO A SET MODE COMMAND                        01117
CONVRTMM EQU   *                                                        01118
         STM   2,3,SAVEUM    SAVE WORK REGISTERS                        01119
         IC    2,MM+1        GET SECOND BYTE OF MM                      01120
         TM    MM+1,X'F0'    IS IT NUMERIC                              01121
         BC    1,MMMM1       YES, BRANCH                                01122
         AH    2,=H'9'       CONVERT ALPHA TO NUMERIC                   01123
MMMM1    SRDL  2,4           SAVE IT                                    01124
         IC    2,MM          GET FIRST BYTE OF MM                       01125
         TM    MM,X'F0'      IS IT NUMERIC                              01126
         BC    1,MMMM2       YES, BRANCH                                01127
         AH    2,=H'9'       CONVERT ALPHA TO NUMERIC      CBT-U MAN    01128
*                                                                       01129
* ABOVE INSTRUCTION ADDED TO CORRECT PROBLEM WHERE YOU CAN CBT-U MAN    01130
* ONLY WRITE AT THE HIGHER DENSITY ON A DUAL-DENSITY DRIVE CBT-U MAN    01131
*                                                                       01132
MMMM2    SLDL  2,4                                                      01133
         STC   2,MM          PUT MM  BACK IN HEX                        01134
         LM    2,3,SAVEUM    RESTORE REGISTERS                          01135
         BR    14                                                       01136
SAVEUM   DS    2F                                                       01137
         SPACE 3                                                        01138
*  ROUTINE TO GET UCB ADDRESS WHEN GIVEN DEVICE ADDRESS                 01139
         SPACE 1                                                        01140
UCBLOKUP EQU   *                                                        01141
         ST    11,SAV11                                                 01142
UCBLOK   EQU   *                                                        01143
         L     R2,16                                                    01144
         L     R5,40(R2)                                                01145
UCBCHK   LH    R2,0(R5)                                                 01146
         LTR   R2,R2                                                    01147
         BZ    INCUCB                                                   01148
         CLC   0(2,R5),=XL2'FFFF'    LAST UCB IN SYSTEM                 01149
         BNE   CKADDR                  NO LOOK AT IT TO SEE IF GOOD     01150
         WTO   'UCB NOT FOUND'                                          01151
         B     ASKAGN                                                   01152
CKADDR   CLC   13(3,R2),D1                                              01153
         BE    UCBFOUND                                                 01154
INCUCB   LA    R5,2(R5)                                                 01155
         B     UCBCHK                                                   01156
UCBFOUND TM    2(R2),X'FF'                                              01157
         BNO   BADEVICE                                                 01158
*        TM    3(2),X'08'         ALLOCATED?               **BW SIK**   01159
*        BC    1,ALOCK            YES; BRANCH              **BW SIK**   01160
*        TM    3(2),X'80'      TEST FOR OFFLINE DEVICE     **BW SIK**   01161
         SPACE 5                                           **BW SIK**   01162
********************************************************** **BW SIK**   01163
*                                                          **BW SIK**   01164
*     THE OFFLINE DEVICE FUNCTION HAS BEEN ARTIFICIALLY    **BW SIK**   01165
*     DISABLED -- TAPE DEVICES MUST NOW BE INDICATED BY    **BW SIK**   01166
*     A DD CARD IN THE DEBE JCL - THE DD NAME IS AT THE    **BW SIK**   01167
*     DISCRETION OF THE USER                               **BW SIK**   01168
*                                                          **BW SIK**   01169
*     THIS ROUTINE CHECKS TO SEE THAT THE UCB REQUESTED    **BW SIK**   01170
*     IN ANY TAPE OPERATION HAS BEEN ALLOCATED AT STEP     **BW SIK**   01171
*     INITIATION BY CHECKING FOR THE UCB ADDRESS IN THE    **BW SIK**   01172
*     TIOT CHAIN FOR THE DEBE TASK -- IF THE UCB ADDRESS   **BW SIK**   01173
*     IS NOT LOCATED THEN THE OPERATION IN PROGRESS IS     **BW SIK**   01174
*     TERMINATED WITH THE ERROR MESSAGE --                 **BW SIK**   01175
*                                                          **BW SIK**   01176
*     'DEBE: REQUESTED DEVICE NOT ALLOCATED, OPERATION     **BW SIK**   01177
*        TERMINATED'                                       **BW SIK**   01178
*                                                          **BW SIK**   01179
*     THE OPERATOR IS THEN PROMPTED FOR THE NEXT OPERATION **BW SIK**   01180
*     TO BE PERFORMED                                      **BW SIK**   01181
*                                                          **BW SIK**   01182
********************************************************** **BW SIK**   01183
*                                                          **BW SIK**   01184
         STM   8,10,MYSAVE             SAVE REGS           **BW SIK**   01185
         L     8,16                    R8 --> CVT          **BW SIK**   01186
         L     9,0(0,8)                R9 --> TCB PTRS     **BW SIK**   01187
         L     10,4(0,9)               R10 --> CURR TCB(ME)**BW SIK**   01188
         L     8,12(0,10)              R8 --> TIOT         **BW SIK**   01189
         LA    8,24(,8)                R8 --> 1 ST ENTRY   **BW SIK**   01190
NEXTUCB  CLI   0(8),X'00'              LAST ENTRY ??       **BW SIK**   01191
         BE    NOTALLOC                YES - DEV NOT ALLOC **BW SIK**   01192
         CH    2,18(0,8)               IS UCB IN TIOT ENTRY *BW SIK**   01193
         BE    DEVOK                   YES - DEVICE OK     **BW SIK**   01194
         LA    8,20(,8)                NO - GET NEXT ENTRY **BW SIK**   01195
         B     NEXTUCB                 NEXT UCB            **BW SIK**   01196
*                                                          **BW SIK**   01197
DEVOK    EQU   *                                           **BW SIK**   01198
         LM    8,10,MYSAVE             RESTORE REGS        **BW SIK**   01199
         BR    14                                          **BW SIK**   01200
*                                                          **BW SIK**   01201
NOTALLOC EQU   *                                           **BW SIK**   01202
         LM    8,10,MYSAVE             RESTORE REGS        **BW SIK**   01203
         WTO   'DEBE: REQUESTED DEVICE NOT ALLOCATED - OPERATION TERMINX01204
               ATED'                                       **BW SIK**   01205
         B     ASKAGN                  GET NEXT FUNCTION   **BW SIK**   01206
*                                                          **BW SIK**   01207
MYSAVE   DS    3F                                          **BW SIK**   01208
*OFLNTEST BNO  DEVOFLIN     BRANCH WILL BE TURNED OFF BY 'OX' COMMAND   01209
*RETRN    EQU   *                                            DEBE9590   01210
*        L     11,SAV11                                                 01211
*        BR    14                                                       01212
*        CMSREG                                       AXC               01213
R0      EQU  0                                        AXC               01214
R1      EQU  1                                        AXC               01215
R2      EQU  2                                        AXC               01216
R3      EQU  3                                        AXC               01217
R4      EQU  4                                        AXC               01218
R5      EQU  5                                        AXC               01219
R6      EQU  6                                        AXC               01220
R7      EQU  7                                        AXC               01221
R8      EQU  8                                        AXC               01222
R9      EQU  9                                        AXC               01223
R10     EQU  10                                       AXC               01224
R11     EQU  11                                       AXC               01225
R12     EQU  12                                       AXC               01226
R13     EQU  13                                       AXC               01227
R14     EQU  14                                       AXC               01228
R15     EQU  15                                       AXC               01229
R16     EQU  16                                       AXC               01230
RA      EQU  10                                       AXC               01231
RB      EQU  11                                       AXC               01232
RC      EQU  12                                       AXC               01233
RD      EQU  13                                       AXC               01234
RE      EQU  14                                       AXC               01235
RF      EQU  15                                       AXC               01236
         LTORG                                                          01237
         SPACE 3                                                        01238
*  ROUTINE TO ASK FOR THE INPUT TAPE                                    01239
         SPACE 1                                                        01240
TAPINSET DS    0H                                                       01241
         WTOR  'DEBE: INPUT TAPE - MMXXX',MM,5,REPLYECB                 01242
         BAL   11,WAITAPE    WAIT FOR A REPLY AND SET UP MODE           01243
         MVC   INTRTCH(1),MM       SET UP TAPE'S DCB                    01244
         MVI   INDEVT,X'81'                                             01245
         CLI   18(2),X'80'       IS IT A TAPE (2 POINTS TO UCB)         01246
         BNE   TPINBD                                                   01247
         ST    2,INDEBMOD          STORE UCB ADDRESS IN DEB             01248
         MVC   INDEBMOD(1),MM      PUT SET MODE CMD IN DEB              01249
         OI    INIOB,X'40'         SET ON CHAINING                      01250
         MVC   INCCW(1),MM       PUT SET MODE IN CCW                    01251
         MVC   INCCW+1(7),=X'00000060000001'                            01252
         BR    10                                                       01253
TPINBD   EQU   *                                                        01254
         WTO   'DEBE: NOT A TAPE'                                       01255
         B     TAPINSET                                                 01256
         SPACE 3                                                        01257
*  ROUTINE TO ASK FOR THE OUTPUT TAPE                                   01258
         SPACE 1                                                        01259
TPOUTSET EQU   *                                                        01260
         WTOR  'DEBE: OUTPUT TAPE - MMXXX',MM,5,REPLYECB                01261
         BAL   11,WAITAPE    WAIT FOR REPLY  AND SET UP MM              01262
         MVC   OUTTRTCH(1),MM                                           01263
         MVI   OUTDEVT,X'81'                                            01264
         CLI   18(2),X'80'       IS IT A TAPE                           01265
         BNE   TPOUTBD                                                  01266
         ST    2,OUTDEBMD          STORE UCB ADDRESS IN DEB             01267
         MVC   OUTDEBMD(1),MM                                           01268
         OI    OUTIOB,X'40'      SET ON CHAINING FLAG                   01269
         MVC   OUTCCW(1),MM      BUILD SET MODE COMMAND                 01270
         MVC   OUTCCW+1(7),=X'00000060000001'                           01271
         BR    10                                                       01272
TPOUTBD  EQU   *                                                        01273
         WTO   'DEBE: NOT A TAPE'                                       01274
         B     TPOUTSET                                                 01275
TAPEBLOK EQU   *                                                        01276
         XC    NBRSW(1),NBRSW                                           01277
         WTOR  'DEBE: NR BLK TO PROCESS OR ALL-XXX',TDAREA,3,REPLYECB   01278
         BAL   11,WAITANS                                               01279
         OC    TDAREA(3),BLANKS                                         01280
         CLC   TDAREA(2),=C'EJ'                                         01281
         BE    ASKAGN                                                   01282
         CLC   TDAREA(3),=C'ALL'                                        01283
         BE    DOALL                                                    01284
         OI    TDAREA+2,X'F0'                                           01285
         PACK  TDWK,TDAREA(3)                                           01286
         CVB   6,TDWK                                                   01287
         BR    10                                                       01288
DOALL    EQU   *                                                        01289
         OI    NBRSW,X'FF'                                              01290
         BR    10                                                       01291
         SPACE 3                                                        01292
*  COMMON I/O ROUTINE FOR OUTPUT                                        01293
         SPACE 1                                                        01294
IOOUT    EQU   *                                                        01295
         XC    OUTECB(4),OUTECB                                         01296
         EXCP  OUTIOB                                                   01297
         WAIT  ECB=OUTECB                                               01298
         NI    OUTDCB+44,X'3F'                                          01299
         BR    11                                                       01300
         SPACE 3                                                        01301
*  COMMON I/O ROUTINE FOR INPUT                                         01302
         SPACE 1                                                        01303
IOIN     EQU   *                                                        01304
         XC    INECB(4),INECB                                           01305
         EXCP  INIOB                                                    01306
         WAIT  ECB=INECB                                                01307
         NI    INDCB+44,X'3F'                                           01308
         BR    11                                                       01309
         SPACE 3                                                        01310
*  COMMON WAIT FOR ALL REPLIES                                          01311
WAITANS  EQU   *                                                        01312
         WAITR ECB=REPLYECB                                             01313
         XC    REPLYECB(4),REPLYECB                                     01314
         BR    11                                                       01315
         SPACE 3                                                        01316
*  ROUTINE TO WAIT ON THE REPLY AND CONVERT THE MM INTO A SET MODE      01317
WAITAPE  EQU   *                                                        01318
         WAIT  ECB=REPLYECB                                             01319
         XC    REPLYECB(4),REPLYECB                                     01320
         OC    MM(5),=C'     '     MAKE ALL CAPS                        01321
         CLC   MM(2),=C'EJ'                                             01322
         BE    ASKAGN                                                   01323
         MVC   TDOUTAR(5),MM  GET MMXXX FOR PRINTING ON LISTING         01324
         MVI   TDOUTAR+5,C' '                                           01325
         MVC   TDOUTAR+6(126),TDOUTAR+5                                 01326
         MVC   TDOUTAR+5(24),=CL24' - MMXXX FOR INPUT TAPE.'            01327
         MVC   TDOUTAR+50(47),=CL47'*** THIS IS NOT A DATA RECORD FROM X01328
               THE TAPE ***'                                            01329
         BAL   14,CONVRTMM                                              01330
         OI    MM,X'03'            SET MODE COMMAND NOW IN MM           01331
         MVC   D1(3),XXX                                                01332
         BAL   14,UCBLOKUP                                              01333
         BR    11                                                       01334
         SPACE 3                                                        01335
*  ROUTINE TO WRITE A TAPEMARK                                          01336
WTM      EQU   *                                                        01337
         ST    11,SV11                                                  01338
         MVC   OUTCCW+8(8),WTCCW       SET UP WTM CCW                   01339
         BAL   11,IOOUT      WRITE A TAPE MARK                          01340
         CLI   OUTECB,X'7F'        EVERYTHING OK                        01341
         BNE   TAPERR        NO, BRANCH                                 01342
         L     11,SV11                                                  01343
         BR    11                                                       01344
         SPACE 3                                                        01345
*  UNIT ALLOCATED ROUTINE                                               01346
ALOCK    EQU   *                                                        01347
         LA    1,WTORMSG                                                01348
NEWADRS  EQU   *     ASK FOR A NEW DEVICE ADDRESS                       01349
         SVC   35               ISSUE WTOR                              01350
         BAL   11,WAITANS                                               01351
         OC    HOLD(3),BLANKS                                           01352
         CLC   HOLD(2),=C'EJ'     NEW TASK?                             01353
         BE    ASKAGN                                                   01354
         MVC   D1(3),HOLD                                               01355
         B     UCBLOK     AVOID RE-SAVING REG11                         01356
         SPACE  3                                                       01357
*  NO UCB FOUND                                                         01358
BADEVICE EQU   *                                                        01359
         LA    1,BDWTOR                                                 01360
         SVC   35                 ISSUE WTOR                            01361
         BAL   11,WAITANS                                               01362
         OC    D1(3),BLANKS                                             01363
         CLC   D1(2),=C'EJ'                                             01364
         BE    ASKAGN                                                   01365
         B     UCBLOK             TRY AGAIN                             01366
         SPACE 3                                                        01367
DEVOFLIN EQU   *     DEVICE ADDRESS GIVEN IS OFFLINE                    01368
         MVC   OFFDEV(3),UNNUM                                          01369
         LA    1,ALLOCMSG                                               01370
         B     NEWADRS                                                  01371
         SPACE 1                                                        01372
APPEND   BR    14                                                       01373
         EJECT                                                          01374
*  CONSTANTS AND CCW'S      * * * * * * * * * * * * * * * * * * * * *   01375
         SPACE 3                                                        01376
HOLD     DS    D                                                        01377
READER1  DC    CL3'012'                                                 01378
PUNCH1   DC    CL3'013'                                                 01379
PRINT1   DC    CL3'002'                                                 01380
         SPACE 3                                                        01381
BFCCW    CCW   X'2F',SFCCW,X'20',1                                      01382
BSCCW    CCW   X'27',BSCCW,X'20',1                                      01383
CP1CCW   CCW   2,TDAREA,X'20',80                                        01384
CP2CCW   CCW   9,TDAREA,X'20',80                                        01385
CTCCW    CCW   1,TDAREA,X'20',80                                        01386
DBCCW    CCW   X'41',TDAREA2,X'20',80                                   01387
PTCCW    CCW   9,TDOUTAR,X'20',132                                      01388
ROCCW    CCW   X'41',BLANKS,X'20',80                                    01389
RUCCW    CCW   15,RUCCW,X'20',1                                         01390
RWCCW    CCW   7,RWCCW,X'20',1                                          01391
SFCCW    CCW   X'3F',SFCCW,X'20',1                                      01392
SKCCW    CCW   X'8B',BLANKS,X'20',1                                     01393
SPCCW    CCW   11,BLANKS,X'20',1                                        01394
SRCCW    CCW   X'37',BSCCW,X'20',1                                      01395
S2CCW    CCW   X'41',TDAREA,X'20',80                                    01396
TDINCCW  CCW   2,TDAREA,X'20',32767                                     01397
TTCCWOUT CCW   1,TDAREA,X'20',32767                                     01398
WTCCW    CCW   31,TDAREA,X'20',1                                        01399
TAPEAREA DC    F'0'      ADDRESS OF TAPE I/O WORK AREA IN SP 0          01400
PRNTABLE DC    CL75' ',C'. (+ &&',CL10' ',C'$*)  -/',CL9' '             01401
         DC    C',%',CL14' ',C'#@''= ',CL65' '                          01402
         DC    C'ABCDEFGHI',CL7' ',C'JKLMNOPQR',CL8' '                  01403
         DC    C'STUVWXYZ',CL6' ',C'0123456789',CL6' '                  01404
         SPACE 3                                                        01405
BLANKS   DC    132C' '                                                  01406
         SPACE 1                                                        01407
TDWK     DS    D                                                        01408
SAVEAREA DC    18F'0'                                                   01409
TDPTABLE DC    C'0123456789ABCDEF'                                      01410
         DS    0F                                                       01411
MESSAGE  DC    AL2(THERE-*)     MESSAGE LENGTH                          01412
         DC    AL2(0)                                                   01413
         DC    C'DEBE: '                                                01414
COUNT    DC    C'NUMBER '                                               01415
         DC    C'RECORDS PROCESSED'                                     01416
THERE    EQU   *                                                        01417
WTORMSG  DS    0F                                                       01418
         DC    AL1(3)                                                   01419
         DC    AL3(HOLD)                                                01420
         DC    A(REPLYECB)                                              01421
         DC    AL2(28)                                                  01422
         DC    AL2(0)                                                   01423
         DC    C'DEBE: UNIT '                                           01424
UNNUM    DS    CL3                                                      01425
         DC    C' ALLOCATED'                                            01426
BDWTOR   DS    0F                                                       01427
         DC    AL1(3)                                                   01428
         DC    AL3(D1)                                                  01429
         DC    A(REPLYECB)                                              01430
         DC    AL2(26)                                                  01431
         DC    AL2(0)                                                   01432
         DC    C'DEBE: UNIT '                                           01433
BDUN     DC    C'XXX INVALID'                                           01434
ALLOCMSG DS    0F                                                       01435
         DC    AL1(3),AL3(HOLD),A(REPLYECB),AL2(29),AL2(0)              01436
         DC    C'DEBE: UNIT '                                           01437
OFFDEV   DC    C'XXX IS OFFLINE'                                        01438
D1       DC    C'0'                                                     01439
D2       DC    C'0'                                                     01440
D3       DC    C'0'                                                     01441
ID       DC    C'00'                                                    01442
MM       DC    C'00'                                                    01443
XXX      DC    C'000'                                                   01444
OF       DC    F'15'                                                    01445
REPLYECB DC    F'0'                                                     01446
HEADER   DC    35C'*'                                      **BW SIK**   01447
HEADERX  DC    30C' '                                      **BW SIK**   01448
         DC    35C'*'                                      **BW SIK**   01449
SAV11    DS    F                                                        01450
TDA      DC    C' '                                                     01451
TDOUTAR  DS    CL132                                                    01452
RECCNT   DC    X'00000F'                                                01453
COND1    DC    X'1F'                                                    01454
RECHDG   DC    C'REC '                                                  01455
         DC    X'2020202020'                                            01456
         DC    C', LENGTH '                                             01457
         DC    X'2020202020'                                            01458
C        DC    H'0'                                                     01459
CLIMIT   DC    H'58'                                                    01460
SV11     DS    F                                                        01461
         SPACE 3                                                        01462
SYSPRTSW DC    X'00'                                                    01463
NBRSW    DC    X'00'                                                    01464
OPENSW   DC    X'00'                                                    01465
PRINT    DCB   DDNAME=SYSPRINT,MACRF=PM,DSORG=PS,RECFM=FBM,LRECL=133,  X01466
               BLKSIZE=133                                              01467
         LTORG                                                          01468
         SPACE 3                                                        01469
TDAREA2  DS    CL101                                                    01470
TDAREAAD DS    0F            SET TDAREA ON FULLWD BOUNDARY              01471
TDAREA   DS    CL80                                                     01472
WORKAREA CSECT                                                          01473
*  SEE THE OS SYSTEM CONTROL BLOCKS MANUAL FOR THE FORMATS OF THE       01474
*  FOLLOWING DCB'S, DEB'S, ECB'S, AND IOB'S.                            01475
*  DCB FOR INPUT DATA SET                                               01476
         SPACE 1                       :                                01477
INDCB    DS    0F                                                       01478
         DC    4F'0'                                                    01479
INTRTCH  EQU   *                                                        01480
INMODSTK EQU   *                                                        01481
         DC    X'00'                                                    01482
INDEVT   DC    X'00'                                                    01483
INDENS   DC    X'00'                                                    01484
         DC    X'00'                                                    01485
         DC    5F'0'                                                    01486
         DC    H'0'                                                     01487
         DC    BL2'1101000000001000'                                    01488
AET1     DC    A(INDEB)                                                 01489
         DC    X'10000000'                                              01490
         DC    5F'0'                                                    01491
         SPACE 1                       :                                01492
*  DEB FOR INPUT DATA SET                                               01493
         SPACE 1                       :                                01494
INIOVEC  EQU   *                                                        01495
AET2     DC    A(APPEND)                                                01496
AET3     DC    A(APPEND)                                                01497
AET4     DC    A(APPEND)                                                01498
AET5     DC    A(APPEND)                                                01499
AET6     DC    A(APPEND)                                                01500
         DC    3F'0'                                                    01501
         DC    X'06000000'                                              01502
INDEB    DS    0F                                                       01503
         DC    F'0'                                                     01504
         DC    X'04'                                                    01505
AET7     DC    AL3(OUTDEB)                                              01506
         DC    X'C0000000'                                              01507
         DC    X'30000000'                                              01508
         DC    2F'0'                                                    01509
         DC    X'0F'                                                    01510
AET8     DC    AL3(INDCB)                                               01511
         DC    X'02'                                                    01512
AET9     DC    AL3(INIOVEC)                                             01513
INDEBMOD DC    X'00'                                                    01514
INDEBUCB DC    X'000000'                                                01515
         DC    F'0'                                                     01516
         SPACE 1                       9                                01517
*  ECB FOR INPUT DATA SET                                               01518
         SPACE 1                       9                                01519
INECB    DC    F'0'                                                     01520
         SPACE 1                                                        01521
*  IOB FOR INPUT DATA SET                                               01522
         SPACE 1                                                        01523
INIOB    DS    0F                                                       01524
         DC    X'0200'                                                  01525
INSENS   DC    H'0'                                                     01526
         DC    X'7F'                                                    01527
AET10    DC    AL3(INECB)                                               01528
INSTAT   DC    2F'0'                                                    01529
AET11    DC    A(INCCW)                                                 01530
AET12    DC    A(INDCB)                                                 01531
         DC    F'0'                                                     01532
         DC    H'1'                                                     01533
         DC    H'0'                                                     01534
INDASD   DC    X'00'                                                    01535
INSEEK   DC    XL7'00'                                                  01536
         SPACE 1                                                        01537
*  CCW'S FOR INPUT DATA SET                                             01538
         SPACE 1                                                        01539
INCCW    DS    5D                                                       01540
         SPACE 3                                                        01541
*  DCB FOR OUTPUT DATA SET                                              01542
         SPACE 1                                                        01543
OUTDCB   DS    0F                                                       01544
         DC    4F'0'                                                    01545
OUTTRTCH EQU   *                                                        01546
OUTMDSTK EQU   *                                                        01547
         DC    X'00'                                                    01548
OUTDEVT  DC    X'00'                                                    01549
OUTDENS  DC    X'00'                                                    01550
         DC    X'00'                                                    01551
         DC    5F'0'                                                    01552
         DC    H'0'                                                     01553
         DC    BL2'1101000000001000'                                    01554
AET13    DC    A(OUTDEB)                                                01555
         DC    X'10000000'                                              01556
         DC    5F'0'                                                    01557
         SPACE 1                                                        01558
*  DEB FOR OUTPUT DATA SET                                              01559
         SPACE 1                                                        01560
OUTIOVEC EQU   *                                                        01561
AET14    DC    A(APPEND)                                                01562
AET15    DC    A(APPEND)                                                01563
AET16    DC    A(APPEND)                                                01564
AET17    DC    A(APPEND)                                                01565
AET18    DC    A(APPEND)                                                01566
         DC    3F'0'                                                    01567
         DC    X'06000000'                                              01568
OUTDEB   DS    0F                                                       01569
         DC    F'0'                                                     01570
         DC    X'17000000'                                              01571
         DC    X'C0000000'                                              01572
         DC    X'30000000'                                              01573
         DC    2F'0'                                                    01574
         DC    X'0F'                                                    01575
AET19    DC    AL3(OUTDCB)                                              01576
         DC    X'02'                                                    01577
AET20    DC    AL3(OUTIOVEC)                                            01578
OUTDEBMD DC    X'00'                                                    01579
OUTDBUCB DC    X'000000'                                                01580
         DC    F'0'                                                     01581
         SPACE 1                                                        01582
*  ECB FOR OUTPUT DATA SET                                              01583
         SPACE 1                                                        01584
OUTECB   DC    F'0'                                                     01585
         SPACE 1                                                        01586
*  IOB FOR OUTPUT DATA SET                                              01587
         SPACE 1                                                        01588
OUTIOB   DS    0F                                                       01589
         DC    XL2'0200'                                                01590
OUTSENS  DC    H'0'                                                     01591
         DC    X'7F'                                                    01592
AET21    DC    AL3(OUTECB)                                              01593
OUTSTAT  DC    2F'0'                                                    01594
AET22    DC    A(OUTCCW)                                                01595
AET23    DC    A(OUTDCB)                                                01596
         DC    F'0'                                                     01597
         DC    H'1'                                                     01598
         DC    H'0'                                                     01599
OUTDASD  DC    X'00'                                                    01600
OUTSEEK  DC    XL7'00'                                                  01601
         SPACE 1                                                        01602
*  CCW'S FOR OUTPUT DATA SET                                            01603
         SPACE 1                                                        01604
OUTCCW   DS    5D                                                       01605
         SPACE 3                                                        01606
         END   OSDEBE                                                   01607
